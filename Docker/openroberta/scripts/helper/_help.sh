#!/bin/bash

echo "run.sh [-q] [-yes] [-D]                                              be quiet, answer all questions with 'y', debug mode"
echo "       help                                                          this text"
echo "       gen <server> | start <server> <-rdbg>| stop <server>          gen builds image; start first tries to stop, then (re-)starts the server; stop stops the server"
echo "       from-hub <server> <repo-name>                                 loads an image from a hub. A repo-name is 'openroberta/server_<x64-or-arm32v7>:<version-as-3.9.0>"
echo "       deploy <server>                                               deploy first calls gen, then calls start"
echo "       admin <server> <admin-cmd>                                    execute admin command on server, e.g. 'cleanup-temp-user-dirs'"
echo "       auto-deploy |                                                 check for git changes for servers found in variable AUTODEPLOY"
echo "       start-all | stop-all                                          start/stop db server and server found in variable SERVERS"
echo "       gen-dbc | start-dbc | stop-dbc                                generate db server, start and stop db server using variable DATABASES"
echo "       backup <database>                                             backup <database>. Note, that \"server-<database>\" (e.g. server-test) is a container TRIGGERing the backup. Must be running"
echo "       backup-save <dbBackup@<remote-host>:<from-path> <to-path>     save a db backup from a remote machine to this machine. <to-path> is relative to BASE-DIR"
echo "       cleanup-temp-user-dirs <server> <hours>                       cleanup temp user dirs that or older than <hours> hours, default is 12"
echo "       alive <url> [mail={always|error}] [msg=<msg>]                 is the server alive? When to send mail (default: always). Set an additional mail header"
echo "       docker-info | network | logs | test-info                      container state, network and some log from running containers; info about deployed servers"
echo ""
echo "       monthly-stat <server> [month] [year]                          monthly stats. Optionally month (e.g. '05', default: last month) and year (e.g. '2021', default: this year)"
echo "       show-server                                                   some data about processes with many open file descriptors (FD)"
echo "       show-resources <server> [<file> [<lower> [<upper> [ <url> [<hours> [<pid>]]]]] show resource usage. Parameter description is in file helper/_showResources.sh"
echo "       show-activity-once <server> [<file> [ <url>]]                 show accumulated user activity. Parameter description is in file helper/_showActivityOnce.shs"
echo ""
echo "dangerous commands:"
echo "       prune                                                         rm as much unused data from docker as possible"
echo "       auto-restart <server> <url> [<secBetween>] [<secRetry>]       restart a container if <url>/rest/alive doesn't respond. Check every <secBetween> sec (default: 60)"
echo "                                                                     to avoid false positives, check again after <secRetry> sec (default 30). Url is like https://dns:port"
echo "                                                                     NEVER start this script twice!. For prod: ./run.sh auto-restart master localhost:8080"
echo "       gen-net                                                       generate the docker network ${DOCKER_NETWORK_NAME}"
echo "       gen-ccbin <arch> <ccbin-version>                              generate a new ccbin image. <arch> should be 'x64',"
echo "                                                                     <ccbin-version> an unused version number. Currently 2."
echo "       gen-base <arch> <ccbin-version> <oraccrsc-tag> <base-version> <ora-cc-rsc>   generate a new base image. <arch> should be 'x64',"
echo "                                                                     <oraccrsc-tag> a tag of the ora-cc-rsc repo, <base-version> the version number of the new base image."
echo "                                                                     <ora-cc-rsc> the path to a clean ora-cc-rsc repo"